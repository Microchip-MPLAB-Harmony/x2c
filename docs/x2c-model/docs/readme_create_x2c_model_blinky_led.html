<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Create an X2C Model based "Bliky LED" demo in MPLAB® Harmony 3 - Microchip MPLAB Harmony X2C help</title> <link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../assets/css/just-the-docs.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', "UA-2724382-16"); </script> <script type="text/javascript" src="../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Create an X2C Model based “Bliky LED” demo in MPLAB® Harmony 3 | Microchip MPLAB Harmony X2C help</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Create an X2C Model based “Bliky LED” demo in MPLAB® Harmony 3" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 X2C package" /> <meta property="og:description" content="Harmony 3 X2C package" /> <link rel="canonical" href="../../x2c-model/docs/readme_create_x2c_model_blinky_led.html" /> <meta property="og:url" content="../../x2c-model/docs/readme_create_x2c_model_blinky_led.html" /> <meta property="og:site_name" content="Microchip MPLAB Harmony X2C help" /> <script type="application/ld+json"> {"@type":"WebPage","url":"../../x2c-model/docs/readme_create_x2c_model_blinky_led.html","headline":"Create an X2C Model based “Bliky LED” demo in MPLAB® Harmony 3","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"description":"Harmony 3 X2C package","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"> <title>Link</title> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item"><a href="../../x2c_scope_license.html" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="../../mplab_harmony_license.html" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="../../release_notes.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="../../index.html" class="navigation-list-link">MPLAB® Harmony X2C</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="../../x2c-model/docs/readme_installing_mh_x2c.html" class="navigation-list-link">Installing MPLAB Harmony X2C Remote Package</a></li><li class="navigation-list-item "><a href="../../x2c-scope/docs/readme.html" class="navigation-list-link">X2CScope</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="../../x2c-scope/docs/readme_installing_x2cScope.html" class="navigation-list-link">Installing X2CScope plugin in MPLAB® X IDE</a> </li><li class="navigation-list-item "> <a href="../../x2c-scope/docs/readme_add_x2cScope_to_your_application.html" class="navigation-list-link">Add X2CScope to your MPLAB® Harmony 3 Application</a> </li></ul></li><li class="navigation-list-item active"><a href="../../x2c-model/docs/readme.html" class="navigation-list-link">X2C Model</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="../../x2c-model/docs/readme_installing_x2c_library.html" class="navigation-list-link">Installing X2C Library</a> </li><li class="navigation-list-item active"> <a href="../../x2c-model/docs/readme_create_x2c_model_blinky_led.html" class="navigation-list-link active">Create an X2C Model based "Bliky LED" demo in MPLAB® Harmony 3</a> </li></ul></li></ul></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search Microchip MPLAB Harmony X2C help" aria-label="Search Microchip MPLAB Harmony X2C help" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> <ul class="list-style-none text-small aux-nav"> <li class="d-inline-block my-0"><a href="https://support.microchip.com">Obtain Support from Microchip</a></li> </ul> </div> <div class="page"> <nav class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../../index.html">MPLAB® Harmony X2C</a></li> <li class="breadcrumb-nav-list-item"><a href="../../x2c-model/docs/readme.html">X2C Model</a></li> <li class="breadcrumb-nav-list-item"><span>Create an X2C Model based "Bliky LED" demo in MPLAB® Harmony 3</span></li> </ol> </nav> <div id="main-content" class="page-content" role="main"> <h1 id="create-an-x2c-model-based-bliky-led-demo-in-mplab-harmony-3"> <a href="#create-an-x2c-model-based-bliky-led-demo-in-mplab-harmony-3" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Create an X2C Model based “Bliky LED” demo in MPLAB® Harmony 3 </h1> <p>This section provides a step by step guide to create an X2C Model based “Bliky LED” demo in MPLAB Harmony 3 running on <a href="https://www.microchip.com/DevelopmentTools/ProductDetails/PartNO/MA320207">ATSAME54 Motor Control Plugin Module</a> + <a href="https://www.microchip.com/DevelopmentTools/ProductDetails/DM330021-2">dsPICDEM™ MCLV-2 Development Board (Low Voltage)</a></p> <h2 id="create-and-setup-an-x2c-model-project-in-mplab-harmony-3"> <a href="#create-and-setup-an-x2c-model-project-in-mplab-harmony-3" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Create and setup an X2C Model project in MPLAB Harmony 3 </h2> <ul> <li>Create ATSAME54P20A based MPLAB Harmony 3 Project <ul> <li>Open MPLAB X IDE -&gt; File -&gt; New Project -&gt; “32-bit MPLAB Harmony Project” -&gt; Set Harmony 3 Path -&gt; Set Project Location, Folder Name and Project Name -&gt; Set Configuration Name -&gt; Select Target MCU - ATSAME54P20A <img src="create_new_mh3_project_1.png" alt="" /></li> </ul> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> <li>Open MPLAB Harmony Configurator <ul> <li>Go to Tools -&gt; Embedded -&gt; MPLAB Harmony Configurator -&gt; Set MPLAB Harmony 3 Path -&gt; Select the default Device Family and CMSIS Pack Paths <img src="../../x2c-model/docs/images/launch_mhc.png" alt="" /></li> </ul> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> <li>Add X2C Model from the list of Available Components -&gt; X2C -&gt; X2C Model into the project and connect the UART port on X2C Model component to the UART port on SERCOM2 component. This allows run time update to the X2C Model using X2C Communicator via UART channel of SERCOM2. Configure the recommended Baud Rate of 115200 bps using the X2C Model Component and set the “Receive Pinout” to SERCOM PAD[1] <img src="../../x2c-model/docs/images/configure_x2c_model.gif" alt="" /> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> <li>The control algorithm developed using X2C model is executed at a fixed interval which can be configured using a timer (TC0). Add TC0 to the project from the list of Available components -&gt; Peripherals -&gt; TC -&gt; TC0 <img src="../../x2c-model/docs/images/add_tc0.gif" alt="" /> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> <li>Configure the timer period of TC0 to match the rate of model execution. Also enable the period match interrupt. In this example, the timer period is set to 50uS. <img src="../../x2c-model/docs/images/configure_tc0.gif" alt="" /> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> <li>Configure I/O pins using Pin Configurator <ul> <li>Configure PD09 and PD10 as digital input for button switch BTN_S2 and BTN_S3 <img src="../../x2c-model/docs/images/configure_input_sw.gif" alt="" /> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> <li>Configure PB26 and PB27 as digital output for LED_D2 and LED_D17 respectively <img src="../../x2c-model/docs/images/configure_output_led.gif" alt="" /> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> <li>Configure PA12 and PA13 as SERCOM2 PAD0 and PAD1 respectively <img src="../../x2c-model/docs/images/configure_sercom2_io.gif" alt="" /> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> </ul> </li> <li>Generate Code <img src="../../x2c-model/docs/images/generate_code.gif" alt="" /> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> </ul> <h2 id="establish-communication-between-x2c-communicator-and-target-mcu"> <a href="#establish-communication-between-x2c-communicator-and-target-mcu" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Establish communication between X2C Communicator and Target MCU </h2> <ul> <li>Open Scilab <img src="../../x2c-model/docs/images/open_scilab.gif" alt="" /> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> <li>Navigate to the project directory in Scilab where the MPLAB Harmony 3 Project was saved - &lt;harmony 3 project path&gt;\firmware\src\config&lt;config name&gt;\X2CCode\X2CModel<br /> <img src="../../x2c-model/docs/images/open_mh3_project_scilab.gif" alt="" /> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> <li>Generate code to configure X2C Communicator communication <ul> <li>Open basicModel.zcos</li> <li>Click on “transform model and push to communicator”</li> <li>Click on “Start Communicator”</li> <li>Wait till you see “Model Set” in the log</li> <li>Click on “Create Code” button <img src="../../x2c-model/docs/images/setup_x2c_communicator.gif" alt="" /></li> </ul> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> <li>Add X2C Communicator API calls to MPLAB Harmony 3 Project <ul> <li>Add <code class="language-plaintext highlighter-rouge">X2C_Communicate()</code> API in while(1) loop in main.c</li> <li>Add <code class="language-plaintext highlighter-rouge">X2C_UpdateModel()</code> API as a call back to TC0 period match interrupt</li> <li>Start TC0 Timer <img src="../../x2c-model/docs/images/add_x2c_communicator_api.gif" alt="" /></li> </ul> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> <li>Make and Program Device Main Project <img src="../../x2c-model/docs/images/build_program_project.gif" alt="" /> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> <li>Verify X2C Communicator Communication <ul> <li>Click on “Start Communicator” (if not already open)</li> <li>Setup Serial Port</li> <li>Click on “Connect to Target” <img src="../../x2c-model/docs/images/connect_x2c_communicator.gif" alt="" /></li> </ul> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> </li> </ul> <h2 id="generate-code-for-blinky-led-model-in-scilabxcos--x2c"> <a href="#generate-code-for-blinky-led-model-in-scilabxcos--x2c" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Generate Code for Blinky LED model in Scilab/Xcos + X2C </h2> <ul> <li>Save <a href="../../x2c-model/docs/X2C_Blinky_LED.zcos"><code class="language-plaintext highlighter-rouge">X2C_Blinky_LED.zcos</code></a> at &lt;harmony 3 project path&gt;\firmware\src\config&lt;config name&gt;\X2CCode\X2CModel\</li> <li>Close any open instances of X2C Communicator</li> <li>Open X2C_Blinky_LED.zcos in Scilab</li> <li>Click on “transform model and push to communicator”</li> <li>Click on “Start Communicator”</li> <li>Wait till you see “Model Set” in the log</li> <li>Click on “Create Code” button <img src="../../x2c-model/docs/images/generate_blinky_led.gif" alt="" /></li> </ul> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> <h2 id="update-readinports-and-writeoutports-function-calls-in-mplabx-project"> <a href="#update-readinports-and-writeoutports-function-calls-in-mplabx-project" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Update “readInports” and “writeOutports” function calls in MPLABX Project </h2> <ul> <li>Open “PortConfigX2C.c” from Source Files -&gt; config -&gt; <config name=""> -&gt; X2CCode -&gt; X2CModel</config></li> <li> <p>Update readInports() as shown below</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  void readInports(void)
  {
      /* TODO add linkage hardware-inputs -&gt; X2C inports here 
       * Pass the peripheral values to model Inports
       * if (PORTA &amp; 1) { 
       *    x2cModel.inports.bInport = INT16_MAX;
       * }else {
       *    x2cModel.inports.bInport = 0;
       * }
       */
      if(BTN_S2_Get())
      {
          x2cModel.inports.bBTN_S2 = 0;
      }
      else
      {
          x2cModel.inports.bBTN_S2 = 1;
      }
  }
</code></pre></div> </div> </li> <li> <p>Update writeOutports() as shown below</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  void writeOutports(void)
  {
   /* TODO add linkage hardware-inputs -&gt; X2C inports here 
   * Pass the peripheral values to model Inports
   * if (PORTA &amp; 1) { 
   *    x2cModel.inports.bInport = INT16_MAX;
   * }else {
   *    x2cModel.inports.bInport = 0;
   * }
   */
      if((*x2cModel.outports.bLED_D2))
      {
          LED_D2_Set();
      }
      else
      {
          LED_D2_Clear();
      }
        
      if((*x2cModel.outports.bLED_D17))
      {
          LED_D17_Set();
      }
      else
      {
          LED_D17_Clear();
      }
  }
</code></pre></div> </div> <p><img src="../../x2c-model/docs/images/update_port_config_x2c.gif" alt="" /></p> </li> </ul> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> <ul> <li>Make and Program Device with MPLAB Harmony 3 project updated with Blinky LED model <img src="../../x2c-model/docs/images/make_program_blinky_led.png" alt="" /></li> </ul> <p>&nbsp;</p> <p>&nbsp;</p> <p>&nbsp;</p> <h2 id="running-the-x2c_blinky_led-demo"> <a href="#running-the-x2c_blinky_led-demo" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Running the X2C_Blinky_LED demo </h2> <ul> <li> <p>Observe LED D2 turn ON when button switch S2 is pressed.</p> </li> <li> <p>Live update LED D17’s blink rate using Scilab/Xcos + X2C</p> <ul> <li>Ensure X2C Communicator is connected</li> <li>Increase/Decrease Frequency input to Sin3Gen block to increase/decrease the LED D17’s blink rate at run time <img src="../../x2c-model/docs/images/update_blink_rate.gif" alt="" /></li> </ul> </li> </ul> <hr> <footer role="contentinfo"> <p class="text-small text-grey-dk-000 mb-0"><img src='../../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2020 Microchip Technology.</p> </footer> </div> </div> </div> </div> </body> </html>
